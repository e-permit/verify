{"version":3,"sources":["PermitView.js","utils.js","App.js","serviceWorker.js","index.js"],"names":["useStyles","makeStyles","theme","root","width","maxWidth","backgroundColor","palette","background","paper","dividerFullWidth","margin","spacing","dividerInset","layout","marginLeft","marginRight","breakpoints","up","marginTop","marginBottom","padding","ribbon","position","color","zIndex","textAlign","textTransform","font","content","display","border","transform","top","span","CredentialView","permit","locale","demo","classes","className","Paper","Typography","component","variant","align","List","ListItem","ListItemText","primary","Alert","severity","valid_signature_message","Divider","issuer_label","secondary","Grid","container","alignItems","item","src","issuer","toLowerCase","height","issued_for_label","issued_for","issued_at_label","issued_at","expire_at_label","expire_at","permit_id_label","id","permit_type_label","type","permit_year_label","year","plate_number_label","plate_number","company_name_label","company_name","ajv","Ajv","rs","require","base64url","AUTHORITIES_URL","validatePermit","qrCode","a","fetch","schemaRes","console","log","json","schema","parseQrCodeResult","parseQrCode","ok","errorCode","version","header","payload","jws","getPermit","authoritiesRes","authoritiesJson","authorities","authoritiyUri","getUri","authorityConfigRes","authorityConfig","publicJwkResult","getPublicJwk","kid","pubKey","KEYUTIL","getKey","jwk","KJUR","JWS","verify","alg","localeR","localeContent","arr","split","JSON","parse","decode","validate","compile","sig","error","errors","trustedAuthority","trusted_authorities","find","x","code","Object","keys","length","publicKey","claims","iat","exp","pn","cn","v","issuedFor","AUD_URI","aud","demo_uri","uri","App","useState","setPermit","loading","setLoading","setDemo","setError","setLocale","window","location","hash","substring","res","useEffect","verifyPermit","CircularProgress","isLocalhost","Boolean","hostname","match","registerValidSW","swUrl","config","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","state","controller","onUpdate","onSuccess","catch","ReactDOM","render","StrictMode","document","getElementById","URL","process","href","origin","addEventListener","headers","response","contentType","get","status","indexOf","ready","unregister","reload","checkValidServiceWorker","event","respondWith","request","caches"],"mappings":"uRAQMA,EAAYC,aAAW,SAACC,GAAD,MAAY,CACrCC,KAAM,CACFC,MAAO,OACPC,SAAU,IACVC,gBAAiBJ,EAAMK,QAAQC,WAAWC,OAE9CC,iBAAkB,CACdC,OAAO,WAAD,OAAaT,EAAMU,QAAQ,GAA3B,OAEVC,aAAc,CACVF,OAAO,WAAD,OAAaT,EAAMU,QAAQ,GAA3B,OAEVE,OAAO,aACHV,MAAO,OACPW,WAAYb,EAAMU,QAAQ,GAC1BI,YAAad,EAAMU,QAAQ,IAC1BV,EAAMe,YAAYC,GAAG,IAAyB,EAAnBhB,EAAMU,QAAQ,IAAU,CAChDR,MAAO,IACPW,WAAY,OACZC,YAAa,SAGrBP,MAAM,aACFU,UAAWjB,EAAMU,QAAQ,GACzBQ,aAAclB,EAAMU,QAAQ,GAC5BS,QAASnB,EAAMU,QAAQ,IACtBV,EAAMe,YAAYC,GAAG,IAAyB,EAAnBhB,EAAMU,QAAQ,IAAU,CAChDO,UAAWjB,EAAMU,QAAQ,GACzBQ,aAAclB,EAAMU,QAAQ,GAC5BS,QAASnB,EAAMU,QAAQ,KAG/BU,OAAQ,CACJhB,gBAAiB,qBACjBiB,SAAU,WACVC,MAAO,MACPpB,MAAO,GACPqB,OAAQ,EACRC,UAAW,SACXC,cAAe,YACfN,QAAS,EACTO,KAAM,OACN,YAAa,CACTL,SAAU,WACVE,QAAS,EACTI,QAAS,GACTC,QAAS,QACTC,OAAQ,qBAEZ,WAAY,CACRR,SAAU,WACVE,QAAS,EACTI,QAAS,GACTC,QAAS,QACTC,OAAQ,qBAEZC,UAAW,iBACXC,IAAK,GACLlB,YAAa,IAEjBmB,KAAM,OAKK,SAASC,EAAT,GAAmD,IAAzBC,EAAwB,EAAxBA,OAAQC,EAAgB,EAAhBA,OAAQC,EAAQ,EAARA,KAC/CC,EAAUvC,IAChB,OACI,uBAAMwC,UAAWD,EAAQzB,OAAzB,UACKwB,GACG,qBAAKE,UAAWD,EAAQjB,OAAxB,SAAgC,sBAAMkB,UAAWD,EAAQL,KAAzB,uBAEpC,eAACO,EAAA,EAAD,CAAOD,UAAWD,EAAQ9B,MAA1B,UACI,cAACiC,EAAA,EAAD,CAAYC,UAAU,KAAKC,QAAQ,KAAKC,MAAM,SAA9C,mCAGA,eAACC,EAAA,EAAD,CAAMN,UAAWD,EAAQpC,KAAzB,UACI,cAAC4C,EAAA,EAAD,UACI,cAACC,EAAA,EAAD,CACIC,QACI,cAACC,EAAA,EAAD,CAAOC,SAAS,UAAhB,SACKd,EAAOe,8BAKxB,cAACC,EAAA,EAAD,CAASV,UAAU,OACnB,cAACI,EAAA,EAAD,UACI,cAACC,EAAA,EAAD,CACIC,QAASZ,EAAOiB,aAChBC,UACI,qBAAKf,UAAWD,EAAQpC,KAAxB,SACI,eAACqD,EAAA,EAAD,CAAMC,WAAS,EAACC,WAAW,SAAS9C,QAAS,EAA7C,UACI,cAAC4C,EAAA,EAAD,CAAMG,MAAI,EAAV,SACI,qBAAKC,IAAG,wBAAmBxB,EAAOyB,OAAOC,cAAjC,QAAsD1D,MAAM,KAAK2D,OAAO,SAEpF,cAACP,EAAA,EAAD,CAAMG,MAAI,EAAV,SAAYtB,EAAO,kBAAoBD,EAAOyB,OAAOC,0BAMzE,cAACT,EAAA,EAAD,CAASV,UAAU,OACnB,cAACI,EAAA,EAAD,UACI,cAACC,EAAA,EAAD,CACIC,QAASZ,EAAO2B,iBAChBT,UACI,qBAAKf,UAAWD,EAAQpC,KAAxB,SACI,eAACqD,EAAA,EAAD,CAAMC,WAAS,EAACC,WAAW,SAAS9C,QAAS,EAA7C,UACI,cAAC4C,EAAA,EAAD,CAAMG,MAAI,EAAV,SACI,qBAAKC,IAAG,wBAAmBxB,EAAO6B,WAAWH,cAArC,QAA0D1D,MAAM,KAAK2D,OAAO,SAExF,cAACP,EAAA,EAAD,CAAMG,MAAI,EAAV,SAAYtB,EAAO,kBAAoBD,EAAO6B,WAAWH,0BAK7E,cAACT,EAAA,EAAD,CAASV,UAAU,OACnB,cAACI,EAAA,EAAD,UACI,cAACC,EAAA,EAAD,CACIC,QAASZ,EAAO6B,gBAChBX,UAAW,qBAAKf,UAAWD,EAAQpC,KAAxB,SAA+BiC,EAAO+B,gBAGzD,cAACd,EAAA,EAAD,CAASV,UAAU,OACnB,cAACI,EAAA,EAAD,UACI,cAACC,EAAA,EAAD,CACIC,QAASZ,EAAO+B,gBAChBb,UAAW,qBAAKf,UAAWD,EAAQpC,KAAxB,SAA+BiC,EAAOiC,gBAGzD,cAAChB,EAAA,EAAD,CAASV,UAAU,OACnB,cAACI,EAAA,EAAD,UACI,cAACC,EAAA,EAAD,CACIC,QAASZ,EAAOiC,gBAChBf,UAAW,qBAAKf,UAAWD,EAAQpC,KAAxB,SAA+BiC,EAAOmC,SAGzD,cAAClB,EAAA,EAAD,CAASV,UAAU,OACnB,cAACI,EAAA,EAAD,UACI,cAACC,EAAA,EAAD,CACIC,QAASZ,EAAOmC,kBAChBjB,UAAW,qBAAKf,UAAWD,EAAQpC,KAAxB,SAA+BkC,EAAO,eAAiBD,EAAOqC,KAAO,eAGxF,cAACpB,EAAA,EAAD,CAASV,UAAU,OACnB,cAACI,EAAA,EAAD,UACI,cAACC,EAAA,EAAD,CACIC,QAASZ,EAAOqC,kBAChBnB,UAAW,qBAAKf,UAAWD,EAAQpC,KAAxB,SAA+BiC,EAAOuC,WAGzD,cAACtB,EAAA,EAAD,CAASV,UAAU,OACnB,cAACI,EAAA,EAAD,UACI,cAACC,EAAA,EAAD,CACIC,QAASZ,EAAOuC,mBAChBrB,UAAW,qBAAKf,UAAWD,EAAQpC,KAAxB,SAA+BiC,EAAOyC,mBAGzD,cAACxB,EAAA,EAAD,CAASV,UAAU,OACnB,cAACI,EAAA,EAAD,UACI,cAACC,EAAA,EAAD,CACIC,QAASZ,EAAOyC,mBAChBvB,UAAW,qBAAKf,UAAWD,EAAQpC,KAAxB,SAA+BiC,EAAO2C,4B,YC1KvEC,EAAM,I,OAAIC,GACVC,EAAKC,EAAQ,IACbC,EAAYD,EAAQ,KACpBE,EAAkB,2BAEjB,SAAeC,EAAtB,kC,4CAAO,WAA8BC,GAA9B,mDAAAC,EAAA,sEACqBC,MAAM,uBAD3B,cACGC,EADH,OAEHC,QAAQC,IAAIF,GAFT,SAGkBA,EAAUG,OAH5B,UAGGC,EAHH,QAIGC,EAAoBC,EAAYT,EAAQO,IACvBG,GALpB,0CAMQ,CAAEA,IAAI,EAAOC,UAAW,mBANhC,eASKC,EAAkCJ,EAAlCI,QAASC,EAAyBL,EAAzBK,OAAQC,EAAiBN,EAAjBM,QAASC,EAAQP,EAARO,IAC5BlE,EAASmE,EAAUF,GAVtB,UAW0BZ,MAAMJ,GAXhC,eAWGmB,EAXH,iBAY2BA,EAAeX,OAZ1C,eAYGY,EAZH,OAaGC,EAAcD,EAAgBC,YAC9BC,EAAgBC,EAAOT,EAASO,EAAatE,EAAO6B,YAdvD,UAe8BwB,MAAMkB,GAfpC,eAeGE,EAfH,iBAgB2BA,EAAmBhB,OAhB9C,WAgBGiB,EAhBH,QAiBGC,EAAkBC,EAAaF,EAAiB1E,EAAOyB,OAAQuC,EAAOa,MACxDhB,GAlBjB,0CAmBQ,CAAEA,IAAI,EAAOC,UAAW,gBAnBhC,WAqBGgB,EAAShC,EAAGiC,QAAQC,OAAOL,EAAgBM,KACjCnC,EAAGoC,KAAKhB,IAAIiB,IAAIC,OAAOlB,EAAKY,EAAQ,CAACd,EAAOqB,MAtBzD,0CAwBQ,CAAExB,IAAI,EAAOC,UAAW,sBAxBhC,eA0BG7D,EAASyE,EAAgBzE,QAAU,KA1BtC,UA2BmBoD,MAAM,kBAAD,OAAmBpD,EAAnB,UA3BxB,eA2BGqF,EA3BH,iBA4ByBA,EAAQ7B,OA5BjC,eA4BG8B,EA5BH,yBA8BI,CAAE1B,IAAI,EAAM7D,OAAQA,EAAQC,OAAQsF,EAAerF,KAAkB,MAAZ6D,IA9B7D,6C,sBAiCA,SAASH,EAAYT,EAAQO,GAChC,IAAM8B,EAAMrC,EAAOsC,MAAM,KACnBzB,EAAS0B,KAAKC,MAAM3C,EAAU4C,OAAOJ,EAAI,KACzCvB,EAAUyB,KAAKC,MAAM3C,EAAU4C,OAAOJ,EAAI,KAC1CK,EAAWjD,EAAIkD,QAAQpC,GAQ7B,OAPcmC,EAAS,CACnB9B,QAASyB,EAAI,GACbxB,OAAQA,EACRC,QAASA,EACT8B,IAAKP,EAAI,KAQN,CACH3B,IAAI,EACJE,QAASyB,EAAI,GACbvB,QAASA,EACTD,OAAQA,EACRE,IAAI,GAAD,OAAKsB,EAAI,GAAT,YAAeA,EAAI,GAAnB,YAAyBA,EAAI,MAThCjC,QAAQC,IAAI,oBACZD,QAAQyC,MAAMH,EAASI,QAChB,CAAEpC,IAAI,IAWd,SAASe,EAAaF,EAAiBjD,EAAQoD,GAClD,IAAMqB,EAAmBxB,EAAgByB,oBACpCC,MAAK,SAACC,GAAD,OAAOA,EAAEC,OAAS7E,KAC5B,IAAKyE,GAA6D,IAAzCK,OAAOC,KAAKN,GAAkBO,OACnD,MAAO,CAAE5C,IAAI,GAEjB,IAAM6C,EAAYR,EAAiBM,KAAKJ,MAAK,SAACC,GAAD,OAAOA,EAAExB,MAAQA,KAC9D,OAAK6B,EAGE,CAAE7C,IAAI,EAAMoB,IAAKyB,GAFb,CAAE7C,IAAI,GAKd,SAASM,EAAUF,GACtB,IAAM0C,EAAS1C,EAAQ9B,GAAGsD,MAAM,KAYhC,MAXe,CACXtD,GAAI8B,EAAQ9B,GACZV,OAAQkF,EAAO,GACf9E,WAAY8E,EAAO,GACnBpE,KAAMoE,EAAO,GACbtE,KAAMsE,EAAO,GACb5E,UAAWkC,EAAQ2C,IACnB3E,UAAWgC,EAAQ4C,IACnBpE,aAAcwB,EAAQ6C,GACtBnE,aAAcsB,EAAQ8C,IAKvB,SAASvC,EAAOwC,EAAG1C,EAAa2C,GACnC,IAAIC,EACEC,EAAM7C,EAAY8B,MAAK,SAACC,GAAD,OAAOA,EAAEC,OAASW,KAM/C,MALU,MAAND,EACAE,EAAUC,EAAIC,SACD,MAANJ,IACPE,EAAUC,EAAIE,KAEXH,ECzDII,MAvCf,WACE,MAA4BC,qBAA5B,mBAAOvH,EAAP,KAAewH,EAAf,KACA,EAA8BD,oBAAS,GAAvC,mBAAOE,EAAP,KAAgBC,EAAhB,KACA,EAAwBH,oBAAS,GAAjC,mBAAOrH,EAAP,KAAayH,EAAb,KACA,EAA0BJ,qBAA1B,mBAAOvB,EAAP,KAAc4B,EAAd,KACA,EAA4BL,qBAA5B,mBAAOtH,EAAP,KAAe4H,EAAf,KALa,4CAMb,8BAAAzE,EAAA,sEAEUc,EAAM4D,OAAOC,SAASC,KAAKC,UAAU,GAF/C,SAGsB/E,EAAegB,GAHrC,QAGUgE,EAHV,QAIWrE,IACLgE,EAAUK,EAAIjI,QACduH,EAAUU,EAAIlI,QACd2H,EAAQO,EAAIhI,OAEZ0H,EAASM,EAAIpE,WAEf4D,GAAW,GAXf,gDAaInE,QAAQyC,MAAR,MACA0B,GAAW,GACXE,EAAS,wBAfb,0DANa,sBA0Bb,OAFAO,qBAAU,kBAxBG,0CAwBGC,KAAgB,IAE5BX,EACK,cAACY,EAAA,EAAD,IACErI,EACF,cAAC,EAAD,CAAYA,OAAQA,EAAQC,OAAQA,EAAQC,KAAMA,IAGvD,cAACY,EAAA,EAAD,CAAOC,SAAS,QAAhB,SACGiF,KC3BHsC,EAAcC,QACW,cAA7BT,OAAOC,SAASS,UAEa,UAA7BV,OAAOC,SAASS,UAEhBV,OAAOC,SAASS,SAASC,MACvB,2DA+CJ,SAASC,EAAgBC,EAAOC,GAC9BC,UAAUC,cACPC,SAASJ,GACTK,MAAK,SAAAC,GACJA,EAAaC,cAAgB,WAC3B,IAAMC,EAAmBF,EAAaG,WACd,MAApBD,IAGJA,EAAiBE,cAAgB,WACA,cAA3BF,EAAiBG,QACfT,UAAUC,cAAcS,YAI1BhG,QAAQC,IACN,iHAKEoF,GAAUA,EAAOY,UACnBZ,EAAOY,SAASP,KAMlB1F,QAAQC,IAAI,sCAGRoF,GAAUA,EAAOa,WACnBb,EAAOa,UAAUR,WAO5BS,OAAM,SAAA1D,GACLzC,QAAQyC,MAAM,4CAA6CA,MCrGjE2D,IAASC,OACP,cAAC,IAAMC,WAAP,UACE,cAAC,EAAD,MAEFC,SAASC,eAAe,SDcnB,SAAkBnB,GACvB,GAA6C,kBAAmBC,UAAW,CAGzE,GADkB,IAAImB,IAAIC,UAAwBnC,OAAOC,SAASmC,MACpDC,SAAWrC,OAAOC,SAASoC,OAIvC,OAGFrC,OAAOsC,iBAAiB,QAAQ,WAC9B,IAAMzB,EAAK,UAAMsB,UAAN,sBAEP3B,IAyEV,SAAiCK,EAAOC,GAEtCvF,MAAMsF,EAAO,CACX0B,QAAS,CAAE,iBAAkB,YAE5BrB,MAAK,SAAAsB,GAEJ,IAAMC,EAAcD,EAASD,QAAQG,IAAI,gBAEnB,MAApBF,EAASG,QACO,MAAfF,IAA8D,IAAvCA,EAAYG,QAAQ,cAG5C7B,UAAUC,cAAc6B,MAAM3B,MAAK,SAAAC,GACjCA,EAAa2B,aAAa5B,MAAK,WAC7BlB,OAAOC,SAAS8C,eAKpBnC,EAAgBC,EAAOC,MAG1Bc,OAAM,WACLnG,QAAQC,IACN,oEAhGAsH,CAAwBnC,EAAOC,GAI/BC,UAAUC,cAAc6B,MAAM3B,MAAK,WACjCzF,QAAQC,IACN,iHAMJkF,EAAgBC,EAAOC,MAI3Bd,OAAOsC,iBAAiB,SAAS,SAAUW,GACzCxH,QAAQC,IAAIuH,GACZA,EAAMC,YACJ3H,MAAM0H,EAAME,SAASvB,OAAM,WACzB,OAAOwB,OAAOzC,MAAMsC,EAAME,iBC5CpCnC,K","file":"static/js/main.d561f2ef.chunk.js","sourcesContent":["import React from \"react\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport List from \"@material-ui/core/List\";\nimport ListItem from \"@material-ui/core/ListItem\";\nimport ListItemText from \"@material-ui/core/ListItemText\";\nimport Divider from \"@material-ui/core/Divider\";\nimport { Grid, Paper, Typography } from \"@material-ui/core\";\nimport { Alert } from \"@material-ui/lab\";\nconst useStyles = makeStyles((theme) => ({\n    root: {\n        width: \"100%\",\n        maxWidth: 500,\n        backgroundColor: theme.palette.background.paper\n    },\n    dividerFullWidth: {\n        margin: `5px 0 0 ${theme.spacing(2)}px`\n    },\n    dividerInset: {\n        margin: `5px 0 0 ${theme.spacing(9)}px`\n    },\n    layout: {\n        width: 'auto',\n        marginLeft: theme.spacing(2),\n        marginRight: theme.spacing(2),\n        [theme.breakpoints.up(600 + theme.spacing(2) * 2)]: {\n            width: 600,\n            marginLeft: 'auto',\n            marginRight: 'auto',\n        },\n    },\n    paper: {\n        marginTop: theme.spacing(3),\n        marginBottom: theme.spacing(3),\n        padding: theme.spacing(2),\n        [theme.breakpoints.up(600 + theme.spacing(3) * 2)]: {\n            marginTop: theme.spacing(6),\n            marginBottom: theme.spacing(6),\n            padding: theme.spacing(3),\n        },\n    },\n    ribbon: {\n        backgroundColor: 'rgb(255, 244, 229)',\n        position: \"absolute\",\n        color: 'red',\n        width: 65,\n        zIndex: 3,\n        textAlign: 'center',\n        textTransform: 'uppercase',\n        padding: 5,\n        font: 'Lato',\n        '&::before': {\n            position: \"absolute\",\n            zIndex: -1,\n            content: '',\n            display: 'block',\n            border: '5px solid #2980b9',\n        },\n        '&::after': {\n            position: \"absolute\",\n            zIndex: -1,\n            content: '',\n            display: 'block',\n            border: '5px solid #2980b9',\n        },\n        transform: 'rotate(-45deg)',\n        top: 60,\n        marginLeft: -10,\n    },\n    span: {\n\n    }\n}));\n\nexport default function CredentialView({ permit, locale, demo }) {\n    const classes = useStyles();\n    return (\n        <main className={classes.layout}>\n            {demo &&\n                <div className={classes.ribbon}><span className={classes.span}>DEMO !!</span>\n                </div>}\n            <Paper className={classes.paper}>\n                <Typography component=\"h4\" variant=\"h5\" align=\"center\">\n                    E-PERMIT VERIFICATION\n                </Typography>\n                <List className={classes.root}>\n                    <ListItem>\n                        <ListItemText\n                            primary={\n                                <Alert severity=\"success\">\n                                    {locale.valid_signature_message}\n                                </Alert>\n                            }\n                        />\n                    </ListItem>\n                    <Divider component=\"li\" />\n                    <ListItem>\n                        <ListItemText\n                            primary={locale.issuer_label}\n                            secondary={\n                                <div className={classes.root}>\n                                    <Grid container alignItems=\"center\" spacing={3}>\n                                        <Grid item>\n                                            <img src={`/verify/flags/${permit.issuer.toLowerCase()}.svg`} width=\"40\" height=\"25\" />\n                                        </Grid>\n                                        <Grid item>{locale[\"authority_name_\" + permit.issuer.toLowerCase()]}</Grid>\n                                    </Grid>\n                                </div>\n                            }\n                        />\n                    </ListItem>\n                    <Divider component=\"li\" />\n                    <ListItem>\n                        <ListItemText\n                            primary={locale.issued_for_label}\n                            secondary={\n                                <div className={classes.root}>\n                                    <Grid container alignItems=\"center\" spacing={3}>\n                                        <Grid item>\n                                            <img src={`/verify/flags/${permit.issued_for.toLowerCase()}.svg`} width=\"40\" height=\"25\" />\n                                        </Grid>\n                                        <Grid item>{locale[\"authority_name_\" + permit.issued_for.toLowerCase()]}</Grid>\n                                    </Grid>\n                                </div>\n                            } />\n                    </ListItem>\n                    <Divider component=\"li\" />\n                    <ListItem>\n                        <ListItemText\n                            primary={locale.issued_at_label}\n                            secondary={<div className={classes.root}>{permit.issued_at}</div>}\n                        />\n                    </ListItem>\n                    <Divider component=\"li\" />\n                    <ListItem>\n                        <ListItemText\n                            primary={locale.expire_at_label}\n                            secondary={<div className={classes.root}>{permit.expire_at}</div>}\n                        />\n                    </ListItem>\n                    <Divider component=\"li\" />\n                    <ListItem>\n                        <ListItemText\n                            primary={locale.permit_id_label}\n                            secondary={<div className={classes.root}>{permit.id}</div>}\n                        />\n                    </ListItem>\n                    <Divider component=\"li\" />\n                    <ListItem>\n                        <ListItemText\n                            primary={locale.permit_type_label}\n                            secondary={<div className={classes.root}>{locale[\"permit_type_\" + permit.type + \"_text\"]}</div>}\n                        />\n                    </ListItem>\n                    <Divider component=\"li\" />\n                    <ListItem>\n                        <ListItemText\n                            primary={locale.permit_year_label}\n                            secondary={<div className={classes.root}>{permit.year}</div>}\n                        />\n                    </ListItem>\n                    <Divider component=\"li\" />\n                    <ListItem>\n                        <ListItemText\n                            primary={locale.plate_number_label}\n                            secondary={<div className={classes.root}>{permit.plate_number}</div>}\n                        />\n                    </ListItem>\n                    <Divider component=\"li\" />\n                    <ListItem>\n                        <ListItemText\n                            primary={locale.company_name_label}\n                            secondary={<div className={classes.root}>{permit.company_name}</div>}\n                        />\n                    </ListItem>\n                </List>\n            </Paper>\n        </main>\n    );\n}\n","import Ajv from \"ajv\"\nconst ajv = new Ajv();\nconst rs = require(\"jsrsasign\");\nconst base64url = require(\"base64-url\");\nconst AUTHORITIES_URL = \"/verify/authorities.json\";\n\nexport async function validatePermit(qrCode) {\n    const schemaRes = await fetch(\"/verify/schema.json\");\n    console.log(schemaRes);\n    const schema = await schemaRes.json();\n    const parseQrCodeResult = parseQrCode(qrCode, schema);\n    if (!parseQrCodeResult.ok) {\n        return { ok: false, errorCode: \"invalid_format\" };\n    }\n\n    const { version, header, payload, jws } = parseQrCodeResult;\n    const permit = getPermit(payload);\n    const authoritiesRes = await fetch(AUTHORITIES_URL);\n    const authoritiesJson = await authoritiesRes.json();\n    const authorities = authoritiesJson.authorities;\n    const authoritiyUri = getUri(version, authorities, permit.issued_for);\n    const authorityConfigRes = await fetch(authoritiyUri);\n    const authorityConfig = await authorityConfigRes.json();\n    const publicJwkResult = getPublicJwk(authorityConfig, permit.issuer, header.kid);\n    if(!publicJwkResult.ok){\n        return { ok: false, errorCode: \"invalid_key\" };\n    }\n    const pubKey = rs.KEYUTIL.getKey(publicJwkResult.jwk);\n    const isValid = rs.KJUR.jws.JWS.verify(jws, pubKey, [header.alg]);\n    if (!isValid) {\n        return { ok: false, errorCode: \"invalid_signature\" };\n    }\n    const locale = authorityConfig.locale || \"en\";\n    const localeR = await fetch(`/verify/locale/${locale}.json`);\n    const localeContent = await localeR.json();\n\n    return { ok: true, permit: permit, locale: localeContent, demo: version === \"0\" };\n}\n\nexport function parseQrCode(qrCode, schema) {\n    const arr = qrCode.split(\".\");\n    const header = JSON.parse(base64url.decode(arr[1]));\n    const payload = JSON.parse(base64url.decode(arr[2]));\n    const validate = ajv.compile(schema);\n    const valid = validate({\n        version: arr[0],\n        header: header,\n        payload: payload,\n        sig: arr[3]\n    });\n\n    if (!valid) {\n        console.log(\"Validation error\");\n        console.error(validate.errors);\n        return { ok: false };\n    }\n    return {\n        ok: true,\n        version: arr[0],\n        payload: payload,\n        header: header,\n        jws: `${arr[1]}.${arr[2]}.${arr[3]}`\n    };\n}\n\nexport function getPublicJwk(authorityConfig, issuer, kid) {\n    const trustedAuthority = authorityConfig.trusted_authorities\n        .find((x) => x.code === issuer);\n    if (!trustedAuthority || Object.keys(trustedAuthority).length === 0) {\n        return { ok: false };\n    }\n    const publicKey = trustedAuthority.keys.find((x) => x.kid === kid);\n    if (!publicKey) {\n        return { ok: false };\n    }\n    return { ok: true, jwk: publicKey };\n}\n\nexport function getPermit(payload) {\n    const claims = payload.id.split(\"-\");\n    const permit = {\n        id: payload.id,\n        issuer: claims[0],\n        issued_for: claims[1],\n        year: claims[2],\n        type: claims[3],\n        issued_at: payload.iat,\n        expire_at: payload.exp,\n        plate_number: payload.pn,\n        company_name: payload.cn\n    }\n    return permit;\n}\n\nexport function getUri(v, authorities, issuedFor) {\n    let AUD_URI;\n    const aud = authorities.find((x) => x.code === issuedFor);\n    if (v === \"0\") {\n        AUD_URI = aud.demo_uri;\n    } else if (v === \"1\") {\n        AUD_URI = aud.uri;\n    }\n    return AUD_URI;\n}\n","import React, { useEffect, useState } from \"react\";\nimport { Alert } from \"@material-ui/lab\";\nimport { CircularProgress } from \"@material-ui/core\";\nimport PermitView from \"./PermitView\";\nimport { validatePermit } from \"./utils\";\n\nfunction App() {\n  const [permit, setPermit] = useState();\n  const [loading, setLoading] = useState(true);\n  const [demo, setDemo] = useState(false);\n  const [error, setError] = useState();\n  const [locale, setLocale] = useState();\n  async function verifyPermit() {\n    try {\n      const jws = window.location.hash.substring(1);\n      const res = await validatePermit(jws);\n      if(res.ok){\n        setLocale(res.locale);\n        setPermit(res.permit);\n        setDemo(res.demo);\n      }else{\n        setError(res.errorCode);\n      }\n      setLoading(false);\n    } catch(error) {\n      console.error(error);\n      setLoading(false);\n      setError(\"An error has occured\");\n    }\n  }\n  useEffect(() => verifyPermit(), []);\n\n  if (loading) {\n    return <CircularProgress />;\n  } else if (permit) {\n    return <PermitView permit={permit} locale={locale} demo={demo} />;\n  } else {\n    return (\n      <Alert severity=\"error\">\n        {error}\n      </Alert>\n    );\n  }\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n  // [::1] is the IPv6 localhost address.\n  window.location.hostname === '[::1]' ||\n  // 127.0.0.0/8 are considered localhost for IPv4.\n  window.location.hostname.match(\n    /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n  )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n            'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n\n    window.addEventListener('fetch', function (event) {\n      console.log(event);\n      event.respondWith(\n        fetch(event.request).catch(function () {\n          return caches.match(event.request)\n        })\n      )\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\nimport * as serviceWorker from \"./serviceWorker\";\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.register();\n"],"sourceRoot":""}