(this.webpackJsonpverify=this.webpackJsonpverify||[]).push([[0],{127:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(13),o=a.n(c),i=a(7),l=a.n(i),s=a(9),u=a(14),p=a(15),m=a(36),d={config:{},changes:[],revocations:[]};function f(e,t){switch(t.type){case"reset":return d;case"init":return Object(p.a)({},t.state);case"login":return Object(p.a)(Object(p.a)({},e),{},{config:t.config});case"addChange":return Object(p.a)(Object(p.a)({},e),{},{changes:t.change});case"removeChanges":return Object(p.a)(Object(p.a)({},e),{},{changes:[]});default:return d}}var g=Object(n.createContext)({state:d,dispatch:function(){return null}}),E=function(e){var t=e.children,a=Object(n.useReducer)(f,d),c=Object(u.a)(a,2),o=c[0],i=c[1];return Object(n.useEffect)((function(){function e(){return(e=Object(s.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(m.a)("state");case 2:(t=e.sent)&&0!==Object.keys(t.config)&&i({type:"reset",state:t});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),Object(n.useEffect)((function(){Object(m.b)("state",o)}),[o]),r.a.createElement(g.Provider,{value:{state:o,dispatch:i}},t)},b=a(149),y=a(30),v=a(128),h=a(151),w=a(164),O=a(153),j=a(154),x=a(152),k=a(165),_=Object({NODE_ENV:"production",PUBLIC_URL:"/verify",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).AUTHORITIES_URL||"https://e-permit.github.io/demo/authorities.json",N=Object(b.a)((function(e){return{text:{padding:e.spacing(2,2,0)},paper:{paddingBottom:50},list:{marginBottom:e.spacing(2)},subheader:{backgroundColor:e.palette.background.paper},grow:{flexGrow:1}}}));function C(){var e=N(),t=Object(n.useState)([]),a=Object(u.a)(t,2),c=a[0],o=a[1],i=r.a.useContext(g).dispatch;return Object(n.useEffect)((function(){function e(){return(e=Object(s.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(_);case 2:return t=e.sent,e.next=5,t.json();case 5:a=e.sent,o(a.authorities);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),r.a.createElement(v.a,{square:!0,className:e.paper},r.a.createElement(y.a,{className:e.text,variant:"h5",gutterBottom:!0},"Authorities"),r.a.createElement(h.a,{className:e.list},r.a.createElement(x.a,{className:e.subheader},"-- Select Authority --"),c.map((function(e){var t=e.id,a=e.uri,n=e.title;return r.a.createElement(r.a.Fragment,{key:t},r.a.createElement(w.a,{button:!0,onClick:Object(s.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=8;break}return e.next=3,fetch(a);case 3:return t=e.sent,e.next=6,t.json();case 6:n=e.sent,i({type:"login",config:n});case 8:case"end":return e.stop()}}),e)})))},r.a.createElement(O.a,null,r.a.createElement(k.a,{alt:"Flag",src:"https://www.countryflags.io/".concat(t,"/flat/64.png")})),r.a.createElement(j.a,{primary:n})))})))," ")}var S=a(160),W=a(159),B=a(161),T=a(155),F=a(162),V=a(59),A=a.n(V),D=a(55),I=a.n(D),R=a(57),U=a.n(R),J=a(58),L=a.t(J,2),K=a(118),P=a(123),q=new U.a;function H(e,t){return G.apply(this,arguments)}function G(){return(G=Object(s.a)(l.a.mark((function e(t,a){var n,r,c,o,i,s,u,p;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.split("."),"v1"!==n[0]){e.next=27;break}if(r=n[1]+"."+n[2]+"."+n[3],c=JSON.parse(P.decode(n[1])),o=JSON.parse(P.decode(n[2])),i=q.compile(L),i({header:c,payload:o,sig:n[3]})){e.next=11;break}return alert(JSON.stringify(i.errors)),e.abrupt("return",{isValid:!1,errorCode:"invalid_cred"});case 11:if(o.aud===a.id||o.iss===a.id){e.next=13;break}return e.abrupt("return",{isValid:!1,errorCode:"invalid_aud"});case 13:if(!(Math.floor(Date.now()/1e3)>=o.exp)){e.next=16;break}return e.abrupt("return",{isValid:!1,errorCode:"invalid_exp"});case 16:if((s=a.authorities.find((function(e){return e.id===o.iss})))&&0!==Object.keys(s).length){e.next=19;break}return e.abrupt("return",{isValid:!1,errorCode:"iss_notfound"});case 19:if((u=s.keys.find((function(e){return e.kid===c.kid})))&&0!==Object.keys(u).length){e.next=22;break}return e.abrupt("return",{isValid:!1,errorCode:"jwk_notfound"});case 22:if(p=K.KEYUTIL.getKey(u),K.KJUR.jws.JWS.verify(r,p,[c.alg])){e.next=26;break}return e.abrupt("return",{isValid:!1,errorCode:"invalid_signature"});case 26:return e.abrupt("return",{isValid:!0,cred:o});case 27:return e.abrupt("return",{isValid:!1,errorCode:"invalid_version"});case 28:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var M=a(163),$=a(156),z=a(157),Y=Object(b.a)((function(e){return{root:{width:"100%",maxWidth:500,backgroundColor:e.palette.background.paper},dividerFullWidth:{margin:"5px 0 0 ".concat(e.spacing(2),"px")},dividerInset:{margin:"5px 0 0 ".concat(e.spacing(9),"px")}}}));function Q(e){var t=Y(),a=e.locale,n=e.cred,c=n.exp,o=n.iat,i=n.iss,l=n.aud,s=n.sub,u=n.cid,p=n.ct,m=n.cy,d=n.comid,f=n.comn,g=n.res,E=new Date(1e3*o).toLocaleDateString(),b=new Date(1e3*c).toLocaleDateString();return r.a.createElement(h.a,{className:t.root},r.a.createElement(w.a,null,r.a.createElement(j.a,{primary:r.a.createElement(M.a,{severity:"success"},a.valid_signature_message)})),r.a.createElement($.a,{component:"li"}),r.a.createElement(w.a,null,r.a.createElement(j.a,{primary:a.iss_label,secondary:r.a.createElement("div",{className:t.root},r.a.createElement(z.a,{container:!0,alignItems:"center",spacing:3},r.a.createElement(z.a,{item:!0},r.a.createElement("img",{alt:"Flag",src:"https://www.countryflags.io/".concat(i,"/flat/32.png")})),r.a.createElement(z.a,{item:!0},a["authority_name_"+i])))})),r.a.createElement($.a,{component:"li"}),r.a.createElement(w.a,null,r.a.createElement(j.a,{primary:a.aud_label,secondary:r.a.createElement("div",{className:t.root},r.a.createElement(z.a,{container:!0,alignItems:"center",spacing:3},r.a.createElement(z.a,{item:!0},r.a.createElement("img",{alt:"Flag",src:"https://www.countryflags.io/".concat(l,"/flat/32.png")})),r.a.createElement(z.a,{item:!0},a["authority_name_"+l])))})),r.a.createElement($.a,{component:"li"}),r.a.createElement(w.a,null,r.a.createElement(j.a,{primary:a.iat_label,secondary:r.a.createElement("div",{className:t.root},E)})),r.a.createElement($.a,{component:"li"}),r.a.createElement(w.a,null,r.a.createElement(j.a,{primary:a.exp_label,secondary:r.a.createElement("div",{className:t.root},b)})),r.a.createElement($.a,{component:"li"}),r.a.createElement(w.a,null,r.a.createElement(j.a,{primary:a.sub_label,secondary:r.a.createElement("div",{className:t.root},s)})),r.a.createElement($.a,{component:"li"}),r.a.createElement(w.a,null,r.a.createElement(j.a,{primary:a.ct_label,secondary:r.a.createElement("div",{className:t.root},a["ct_"+p+"_text"])})),r.a.createElement($.a,{component:"li"}),r.a.createElement(w.a,null,r.a.createElement(j.a,{primary:a.cy_label,secondary:r.a.createElement("div",{className:t.root},m)})),r.a.createElement($.a,{component:"li"}),r.a.createElement(w.a,null,r.a.createElement(j.a,{primary:a.cid_label,secondary:r.a.createElement("div",{className:t.root},u)})),r.a.createElement($.a,{component:"li"}),r.a.createElement(w.a,null,r.a.createElement(j.a,{primary:a.comid_label,secondary:r.a.createElement("div",{className:t.root},d)})),f&&r.a.createElement(r.a.Fragment,null," ",r.a.createElement($.a,{component:"li"}),r.a.createElement(w.a,null,r.a.createElement(j.a,{primary:a.comn_label,secondary:r.a.createElement("div",{className:t.root},f)}))),g&&r.a.createElement(r.a.Fragment,null," ",r.a.createElement($.a,{component:"li"}),r.a.createElement(w.a,null,r.a.createElement(j.a,{primary:a.res_label,secondary:r.a.createElement("div",{className:t.root},g)}))))}var X=a(158);function Z(e){var t=Object(n.useState)(),a=Object(u.a)(t,2),c=a[0],o=a[1];return Object(n.useEffect)((function(){function t(){return(t=Object(s.a)(l.a.mark((function t(){var a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,H(e.data,e.config,e.revocations);case 3:a=t.sent,o(a),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),alert(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}),[e]),c?c.isValid?r.a.createElement(Q,{cred:c.cred,locale:e.config.locale}):r.a.createElement(M.a,{severity:"error"},e.config.locale[c.errorCode+"_message"]):r.a.createElement(X.a,null)}var ee=Object(b.a)((function(e){return{text:{padding:e.spacing(2,2,0)},paper:{paddingBottom:50},list:{marginBottom:e.spacing(2)},subheader:{backgroundColor:e.palette.background.paper},appBar:{top:"auto",bottom:0},grow:{flexGrow:1},fabButton:{position:"absolute",zIndex:1,top:-30,left:0,right:0,margin:"0 auto"}}}));function te(){var e=ee(),t=r.a.useContext(g).state,a=Object(n.useState)({page:"scan",data:""}),c=Object(u.a)(a,2),o=c[0],i=c[1];function p(){return(p=Object(s.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t&&i({page:"result",data:t});case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return r.a.createElement(r.a.Fragment,null,r.a.createElement(W.a,null),r.a.createElement(v.a,{square:!0,variant:"outlined",className:e.paper},"result"===o.page?r.a.createElement(Z,{data:o.data,config:t.config,revocations:t.revocations}):r.a.createElement(I.a,{delay:300,onError:function(e){console.error(e)},onScan:function(e){return p.apply(this,arguments)},style:{width:"100%"}})),r.a.createElement(S.a,{position:"fixed",color:"primary",className:e.appBar},r.a.createElement(B.a,null,r.a.createElement(T.a,{edge:"start",color:"inherit","aria-label":"open drawer"},r.a.createElement("img",{alt:"Flag",src:"https://www.countryflags.io/".concat(t.config.id,"/flat/32.png")})),t.config.locale["authority_name_"+t.config.id],0!==Object.keys(t.config).length&&r.a.createElement(F.a,{color:"secondary","aria-label":"add",className:e.fabButton,onClick:function(){i({page:"scan",data:""})}},r.a.createElement(A.a,null)))))}function ae(){var e=r.a.useContext(g).state;return r.a.createElement(r.a.Fragment,null,0===Object.keys(e.config).length?r.a.createElement(C,null):r.a.createElement(te,null))}var ne=function(){return r.a.createElement(E,null,r.a.createElement(ae,null))},re=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function ce(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var a=e.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(ne,null)),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/verify",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/verify","/service-worker.js");re?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):ce(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):ce(t,e)}))}}()},58:function(e){e.exports=JSON.parse('{"type":"object","properties":{"header":{"type":"object","properties":{"alg":{"type":"string","enum":["ES256"]},"kid":{"type":"string"}},"required":["alg","kid"]},"payload":{"type":"object","properties":{"iss":{"type":"string"},"aud":{"type":"string"},"sub":{"type":"string"},"exp":{"type":"string"},"iat":{"type":"string"},"ct":{"type":"string","enum":["1","2","3"]},"cid":{"type":"string"},"cy":{"type":"string","pattern":"^\\\\d{4}$"},"comid":{"type":"string"},"comn":{"type":"string"},"res":{"type":"string"}},"required":["iss","aud","sub","exp","iat","ct","cid","cy","comid"]},"sig":{"type":"string"}},"required":["header","payload","sig"]}')},71:function(e,t,a){e.exports=a(127)}},[[71,1,2]]]);
//# sourceMappingURL=main.c1a15b92.chunk.js.map